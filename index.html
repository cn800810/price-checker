<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>商品价格查询</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { margin: 4px; }
    img { max-width: 80px; display: block; }
    li { margin-bottom: 10px; }
  </style>
</head>
<body>

<h2>商品价格查询</h2>

<input id="code" placeholder="商品编码">
<input id="name" placeholder="商品名">
<input id="price" placeholder="价格">
<input id="image" placeholder="图片URL">
<button onclick="save()">保存 / 更新</button>

<h3>商品列表</h3>
<ul id="list"></ul>

<script>
const supabase = supabaseJs.createClient(
  'https://ikdxkrmpuyvkoifmfzcu.supabase.co',
  'sb_publishable_WJFKBCmGiyz4Wm1lVoTUfQ_HevLelwn'
)

async function loadList() {
  const { data, error } = await supabase
    .from('products')
    .select('*')
    .order('created_at', { ascending: false })

  const list = document.getElementById('list')
  list.innerHTML = ''

  if (error || !data) {
    list.innerHTML = '<li>无法加载数据</li>'
    return
  }

  data.forEach(item => {
    const li = document.createElement('li')
    li.innerHTML = `
      <b>${item.code}</b> - ${item.name} - ¥${item.price}<br>
      ${item.image ? `< img src="${item.image}">` : ''}
      <button onclick="edit('${item.code}','${item.name}',${item.price},'${item.image || ''}')">编辑</button>
      <button onclick="remove('${item.code}')">删除</button>
    `
    list.appendChild(li)
  })
}

async function save() {
  const code = code.value.trim()
  if (!code) return alert('必须填写编码')

  await supabase.from('products').upsert({
    code,
    name: name.value,
    price: price.value,
    image: image.value
  })

  loadList()
}

function edit(c,n,p,i) {
  code.value = c
  name.value = n
  price.value = p
  image.value = i
}

async function remove(code) {
  if (!confirm('确定删除？')) return
  await supabase.from('products').delete().eq('code', code)
  loadList()
}

loadList()
</script>

</body>
</html>
