<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>价格查询（共享版）</title>

<!-- ✅ Supabase 官方 SDK（关键！） -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body { font-family: Arial; background:#f5f5f5; margin:0; }
h2 { text-align:center; margin:20px 0; }
.input-box { width:90%; margin:auto; }
input,button { width:100%; padding:12px; font-size:18px; margin-top:10px; }
button { background:#2d89ef; color:#fff; border:none; border-radius:8px; }
#list { padding:10px; }
.item { background:#fff; padding:10px; margin:10px 0; border-radius:8px; }
.price { color:green; font-size:20px; }
</style>
</head>

<body>

<h2>价格查询（多人共享）</h2>

<div class="input-box">
  <input id="codeInput" placeholder="输入商品代码"/>
  <button onclick="search()">查询 / 保存</button>
</div>

<div id="list"></div>

<script>
/* ========= Supabase 初始化 ========= */
const supabase = window.supabase.createClient(
  "https://ikdxkrmpuyvkoifmfzcu.supabase.co",
  "sb_publishable_WJFKBCmGiyz4Wm1lVoTUfQ_HevLelwn"
);

/* ========= 查询 / 保存 ========= */
async function search(){
  const code = document.getElementById("codeInput").value.trim();
  if(!code){ alert("请输入商品代码"); return; }

  const { data } = await supabase
    .from("products")
    .select("*")
    .eq("code", code)
    .single();

  if(data){
    const price = prompt("当前价格："+(data.price ?? "未设置")+"\n输入新价格：", data.price ?? "");
    if(price){
      await supabase.from("products")
        .update({ price })
        .eq("code", code);
    }
  }else{
    const price = prompt("新商品，输入价格：");
    if(price){
      await supabase.from("products")
        .insert({ code, price });
    }
  }

  loadList();
}

/* ========= 加载列表 ========= */
async function loadList(){
  const { data } = await supabase
    .from("products")
    .select("*")
    .order("created_at", { ascending:false });

  const list = document.getElementById("list");
  list.innerHTML = "";

  data.forEach(p=>{
    const d = document.createElement("div");
    d.className = "item";
    d.innerHTML = `
      <div><b>${p.code}</b></div>
      <div class="price">¥ ${p.price ?? "未设置"}</div>
    `;
    list.appendChild(d);
  });
}

loadList();
</script>

</body>
</html>
